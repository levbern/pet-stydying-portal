{% extends "base.html"%}

{%block main_content%}
<div class="container" style="margin-top: 100px; padding-bottom: 50px;">
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="row">
        <div class="col-md-8 mb-4">
            <input type="text" id="searchInput" class="find search-input" 
                   placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫—É—Ä—Å–∞–º –∏ —Ç—ç–≥–∞–º...">
        </div>
        {%if admin%}
            <div class="col-md-4 mb-4 d-flex align-items-center justify-content-center">
                <a href="/add_course" class="btn btn-outblock align-items-center px-4">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</a>
            </div>
        {%endif%}
    </div>
    <div class="row mb-4">
        <div class="col-md-8" style="width: 100%;">
            <div class="d-flex flex-wrap justify-content-start" id="tagFilters">
                <div class="tag-filter active" data-tag="all">–í—Å–µ –∫—É—Ä—Å—ã</div>
                <div class="tag-filter" data-tag="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
                <div class="tag-filter" data-tag="–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                <div class="tag-filter" data-tag="–ª–∏–Ω–≥–≤–∏—Å—Ç–∏–∫–∞">–õ–∏–Ω–≥–≤–∏—Å—Ç–∏–∫–∞</div>
                <div class="tag-filter" data-tag="—Ñ–∏–∑–∏–∫–∞">–§–∏–∑–∏–∫–∞</div>
                <div class="tag-filter" data-tag="–∏—Å—Ç–æ—Ä–∏—è">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫—É—Ä—Å–æ–≤ -->
    <div class="row g-4" id="coursesContainer">
        <!-- –í—ã–≤–æ–¥ –≤—Å–µ—Ö –∫—É—Ä—Å–æ–≤-->
        {% for course in courses %}
            <div class="col-lg-4 col-md-6" data-tags="{{course['subject']}}">
                <div class="course-card animated-card">
                    <div class="course-content">
                        <h5 class="mb-3">{{course['name']}}</h5>
                        <p class="text-grey mb-4">{{course['description']}}</p>

                        <!-- –ù–∏–∂–Ω–∏–π –±–ª–æ–∫ —Å —Ç–µ–≥–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–æ–π -->
                        <div class="mt-auto">
                            <div class="mb-4">
                                {% for tag in course['tags'] %}
                                    <span class="course-tag">{{tag}}</span>
                                {% endfor %}
                            </div>
                            <a href="/course/{{course['id']}}" class="btn btn-purple btn-courses w-100 text-decoration-none">–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('searchInput');
        const tagFilters = document.querySelectorAll('.tag-filter');
        const courses = document.querySelectorAll('[data-tags]');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
        document.querySelectorAll('.animated-card').forEach((card, index) => {
            card.style.animationDelay = `${index * 0.15}s`;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        searchInput.addEventListener('input', filterCourses);
        tagFilters.forEach(tag => tag.addEventListener('click', toggleTagFilter));

        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const activeTags = Array.from(document.querySelectorAll('.tag-filter.active'))
                                .map(tag => tag.dataset.tag);

            courses.forEach(course => {
                const courseTags = course.dataset.tags.split(' ');
                const courseName = course.querySelector('h5').textContent.toLowerCase();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                const matchesSearch = courseName.includes(searchTerm) || 
                                    course.textContent.toLowerCase().includes(searchTerm);
                
                // –ò–∑–º–µ–Ω–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞: –ò–õ–ò –≤–º–µ—Å—Ç–æ –ò (some –≤–º–µ—Å—Ç–æ every)
                const matchesTags = activeTags.includes('all') || 
                                (activeTags.length > 0 && 
                                activeTags.some(tag => courseTags.includes(tag)));

                course.style.display = (matchesSearch && matchesTags) ? 'block' : 'none';
            });
        }

        function toggleTagFilter(e) {
            const tag = e.target;
            if (tag.dataset.tag === 'all') {
                tagFilters.forEach(t => t.classList.remove('active'));
                tag.classList.add('active');
            } else {
                document.querySelector('[data-tag="all"]').classList.remove('active');
                tag.classList.toggle('active');
            }
            filterCourses();
        }
    });
</script>
{% endblock %}